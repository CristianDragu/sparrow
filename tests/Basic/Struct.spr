//!! -t "SparrowImplicitLib.spr" --dump-assembly
package Test;

concept AnyType(x);

class Book { var author, name, isbn: StringRef; }
class CollectionBook { var book: Book; var col: StringRef; }

fun Book(author, name, isbn: StringRef): Book {
    var res: Book = Uninitialized();
    construct(res.author, StringRef(author));
    construct(res.name, name);
    res.isbn construct isbn;
    return res;
}

fun CollectionBook(book: Book, collection: StringRef): CollectionBook {
    var res: CollectionBook = Uninitialized();
    res.book construct book;
    res.col construct collection;
    return res;
}

fun CollectionBook(author, name, isbn, collection: StringRef): CollectionBook {
    var res: CollectionBook = Uninitialized();
    res.book construct Book(author, name, isbn);
    res.col construct collection;
    return res;
}

fun[native("test")] test(n: Int)
{
    var b = Book("LucTeo", "The wonders of Sparrow", "ISBN");
    writeLn(b.author);
    writeLn(b.name);
    writeLn(b.isbn);
    writeLn("---");
    var cb1 = CollectionBook(b, "Sparrow");
    writeLn(cb1.book.author);
    writeLn(cb1.book.name);
    writeLn(cb1.book.isbn);
    writeLn(cb1.col);
    writeLn("---");
    var cb2 = CollectionBook("LucTeo", "More wonders of Sparrow", "ISBN", "Sparrow");
    writeLn(cb2.book.author);
    writeLn(cb2.book.name);
    writeLn(cb2.book.isbn);
    writeLn(cb2.col);
}

/*<<<Running()
LucTeo
The wonders of Sparrow
ISBN
---
LucTeo
The wonders of Sparrow
ISBN
Sparrow
---
LucTeo
More wonders of Sparrow
ISBN
Sparrow
>>>*/
