//!! -t "SparrowImplicitLib.spr" -fno-main

concept AnyType(x);

class Book { var author, name, isbn: StringRef; }
class CollectionBook { var book: Book; var col: StringRef; }

//datatype Book2 = StringRef * StringRef;
datatype Book3 { author, name, isbn: StringRef}
datatype Book4 = Book;

datatype Opaque = @Byte;

fun Book(author, name, isbn: StringRef): Book {
    var res: Book = Uninitialized();
    construct(res.author, StringRef(author));
    construct(res.name, name);
    res.isbn construct isbn;
    return res;
}

fun Book3(author, name, isbn: StringRef): Book3 {
    var res: Book3 = Uninitialized();
    res.author construct author;
    res.name construct name;
    res.isbn construct isbn;
    return res;
}

fun Book4(author, name, isbn: StringRef): Book4 {
    var res: Book4 = Uninitialized();
    res.data.author construct author;
    res.data.name construct name;
    res.data.isbn construct isbn;
    return res;
}

fun CollectionBook(book: Book, collection: StringRef): CollectionBook {
    var res: CollectionBook = Uninitialized();
    res.book construct book;
    res.col construct collection;
    return res;
}

fun CollectionBook(author, name, isbn, collection: StringRef): CollectionBook {
    var res: CollectionBook = Uninitialized();
    res.book construct Book(author, name, isbn);
    res.col construct collection;
    return res;
}

fun[native("test")] test(n: Int)
{
    var b = Book("LucTeo", "The wonders of Sparrow", "ISBN");
    writeLn(b.author);
    writeLn(b.name);
    writeLn(b.isbn);
    writeLn("---");
    var cb1 = CollectionBook(b, "Sparrow");
    writeLn(cb1.book.author);
    writeLn(cb1.book.name);
    writeLn(cb1.book.isbn);
    writeLn(cb1.col);
    writeLn("---");
    var cb2 = CollectionBook("LucTeo", "More wonders of Sparrow", "ISBN", "Sparrow");
    writeLn(cb2.book.author);
    writeLn(cb2.book.name);
    writeLn(cb2.book.isbn);
    writeLn(cb2.col);

    writeLn("---");
    var b3 = Book3("LucTeo", "Nice datastructs in Sparrow", "ISBN");
    var b4 = Book4("LucTeo", "Nicer datastructs in Sparrow", "ISBN");
    writeLn(b3.name);
    writeLn(b4.data.name);

    var b4_1 = Book4(b);
    writeLn(b4_1.data.name);

    var o: Opaque = reinterpretCast(@Byte, b);
}

/*<<<Running()
LucTeo
The wonders of Sparrow
ISBN
---
LucTeo
The wonders of Sparrow
ISBN
Sparrow
---
LucTeo
More wonders of Sparrow
ISBN
Sparrow
---
Nice datastructs in Sparrow
Nicer datastructs in Sparrow
The wonders of Sparrow
>>>*/
