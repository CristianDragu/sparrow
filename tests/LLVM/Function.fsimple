//!! -t ""
nodelist{

    backendcode{
"@.str = private unnamed_addr constant [4 x i8] c\"15\\0A\\00\", align 1"
"@.fmtInt = private unnamed_addr constant [4 x i8] c\"%d\\0A\\00\", align 1"
""
"define void @writeLnInt(i32 %val) {"
"  %1 = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([4 x i8]* @.fmtInt, i32 0, i32 0), i32 %val)"
"  ret void"
"}"
""
"define i32 @mul(i32 %x, i32 %y) {"
"  %1 = mul i32 %x,%y"
"  ret i32 %1"
"}"
""
"define i32 @sub(i32 %x, i32 %y) {"
"  %1 = sub i32 %x,%y"
"  ret i32 %1"
"}"
""
"define i1 @equal(i32 %x, i32 %y) {"
"  %1 = icmp eq i32 %x,%y"
"  ret i1 %1"
"}"
""
"define i32 @main(i32 %argc, i8** %argv) nounwind uwtable {"
"  %1 = alloca i32, align 4"
"  %2 = alloca i32, align 4"
"  %3 = alloca i8**, align 8"
"  store i32 0, i32* %1"
"  store i32 %argc, i32* %2, align 4"
"  store i8** %argv, i8*** %3, align 8"
"  %4 = load i8*** %3, align 8"
"  %5 = getelementptr inbounds i8** %4, i64 1"
"  %6 = load i8** %5"
"  %7 = call i32 @atoi(i8* %6) nounwind readonly"
"  call void @test(i32 %7)"
"  ret i32 0"
"}"
""
"declare i32 @atoi(i8*) nounwind readonly"
"declare i32 @printf(i8*, ...)"
"declare void @test(i32)"
    }
    
    class { Int
        autoct
        propStr("nativeName", "i32")
    }
    
    class { Bool
        autoct
        propStr("nativeName", "u1")
    }
    
    function(writeLnInt, params(var(val,Int)), void)
    function(mul, params(var(x,Int),var(y,Int)), Int)
    function(sub, params(var(x,Int),var(y,Int)), Int)
    function(equal, params(var(x,Int),var(y,Int)), Bool)
    
    function(factorial, params(var(n,Int)), Int, localspace{
        if(funCall(equal, memLoad(varRef(n)), ctValueBin(Int, "00 00 00 00")),
            return(ctValueBin(Int, "01 00 00 00")),
            return(funCall(mul, 
                memLoad(varRef(n)),
                funCall(factorial, funCall(sub, memLoad(varRef(n)), ctValueBin(Int, "01 00 00 00")))
            ))
        )
        return(ctValueBin(Int, "00 00 00 00"))
    })

    function(test, params(var(x,Int)), void, localspace{
        funCall(writeLnInt, ctValueBin(Int, "0f 00 00 00"))
        funCall(writeLnInt, funCall(factorial, memLoad(varRef(x))))
        return
    })
}

/*<<<Running(5)
15
120
>>>*/

/*<<<Running(6)
15
720
>>>*/
